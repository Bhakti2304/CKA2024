## Docker Port Mapping

- Port mapping in Docker is the process of mapping a port on the host machine to a port in the container.
- This is essential for accessing applications running inside containers from outside the Docker host.

- Imagine if your Web app. running inside a Docker container on a Port 3200. By default, this port is accessible within a Docker network only and not from your host machine or external network.
- To make this server accessible outside the container, you need to forward a port from host to cotainer.

  ```bash
  docker run -p <host_port>:<container_port> <image_name>
  ```

  -p flag refers to port mapping
  
## Docker File

- The Docker file contains a series of instructions to build a Doker image.

- Key instructions in Dockerfile:

  - FROM: Set the base image
  - WORKDIR: Set the working directory
  - COPY: Copies files from the host system to the container
  - RUN: Execute command in container
  - CMD: Specify the command to run once the container starts
  - EXPOSE: Documents which ports the container listens on

- Example file:

```FROM ubuntu: 18.04```      // This instruction creates a base layer by pulling the ubuntu: 18.04 image from the Docker registry.

```COPY . /app ```           // This instruction creates a new layer on top of the base layer. It copies the entire contents of the build context (the directory containing the Dockerfile) into the /app directory inside the container.
              
```RUN make /app```          // This instruction creates another layer by running the make /app command inside the container. This command builds the application located in the /app directory.

```CMD python /app/app.py```  // This creates a new layer and specifies the default command to run when the container starts, which is python /app/app.py.

## Docker Tags

- Docker tag refers to Docker image.
- It is alias to the ID of Docker image.
- By default, Docker uses the ```latest``` tag.
- Tags can help differentiate between development, staging, and production environments.

```bash
docker tag <source_image>:<tag_name> <target_image>:<tag_name>
```  

```bash
docker build -t <user_name>/<image_name>:<tag_name>
```

```bash
docker pull <user_name>/<repo_name>:<tag_name>
```

## Docker Volumes

- Docker volumes are file systems that are mounted on Docker containers to preserve the data generated by the container.
- In Docker, volumes are the most effective way to store data.
- Using the docker volume create command, we may directly create a volume, or Docker can do it for us when it makes a container or service.
- 3 main types of volumes: NAmed Volumes, Bind Mounts, tmpfs Mounts

![image](https://github.com/Bhakti2304/CKA2024/assets/116799960/15a4386e-0e65-4730-9373-f7deb0574835)

- create a named volume
```bash
docker volume create <volume_name>
```

-  mount the volume to the directory inside the container
```bash
docker run -d -p 3000:3000 -e <env_var_name>=mongodb://mongo:27017/ts-express-app -v <volume_name>:<path_inside_container> <image_name>
```
  - -d: refers to container runs in 'detached mode'
  - -p: port mapping
  - -e: sets an environment variable inside the container
  - -v: refers to mounts a volume from host to container
- Here, any data written to /app/data inside the container will be stored in the named volume on the host.

- To show your details about the volume, including its location on the host filesystem
```bash
docker volume inspect <volume_name>
```

- To remove a volume
```bash
docker volume rm <volume_name>
```

